---
version: 2.1

description: |
  Feedyard common-pipeline-tasks is an example set of shared commands and jobs that team(s)
  would use to standardize basic team practices or conventions.
  Orb source code - https://github.com/feedyard/circleci-orbs/blob/master/src/common-pipeline-tasks/orb.yaml

examples:

  decrypt_local_file:
    description: |
      Use this command to decrypt a local file using openssl aes-256-cbc key encryption. Define default
      orb values according to team conventions to make it easy to 'do the right thing'.
    usage:
      version: 2.1
      orbs:
        common-tasks: feedyard/common-pipeline-tasks@0.1.1
      workflows:
        pipeline:
          jobs:
            - common-tasks/decrypt-env:
                encryption-key: $ENV_VAR
                encoded-file: filename.in
                decoded-file: filename.out

commands:

  decrypt-env:
    description: decrypt env file
    parameters:
      encryption-key:
        description: Encryption key (recommend 100 chars or more in random key gen)
        type: string
        default: $FEEDYARD_CIRCLECI_ENC
      encoded-file:
        description: Name of encrypted file
        type: string
        default: env.ci
      decoded-file:
        description: Name of decrypted output file
        type: string
        default: local.env
    steps:
      - run:
          name: decrypt local file
          command: openssl aes-256-cbc -d -in << parameters.encoded-file >> -out << parameters.decoded-file >> -k <<parameters.encryption-key >>
